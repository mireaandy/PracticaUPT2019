<!DOCTYPE html>
<html>
    <head>
        <title>Practica 2019 Tema 6</title>
    </head>
    <body>
        <script>

            const SIZE = 100000;

            var BitVector = function(size)
            {
                this.store = [size/32+1];
            }
            BitVector.prototype.setBit = function(bit, val)
            {
                var index = ~~(bit / 32);
                var shift = ~~(bit % 32);
                var mask = 1 << shift;
                if (val){
                        this.store[index] = this.store[index] | mask;
                } else {
                        this.store[index] = this.store[index] & ~mask;
                }
            }
            BitVector.prototype.isSet = function(bit)
            {
                var index = ~~(bit / 32);
                var shift = ~~(bit % 32);
                var mask = 1 << shift;
                return (this.store[index] & mask) > 0;
            }

            var Set = function(values)
            {
                this.bitArray = new BitVector(SIZE);
                this.size = 0;
                if(values)
                {
                    this.size = values.length;
                    var posElementsArray = 0;
                    var wasSet = false;
                    for(var position = 0; position < SIZE; position++)
                    {
                        if(posElementsArray < values.length)
                        {
                            if(position === values[posElementsArray])
                            {
                                wasSet = 1;
                                posElementsArray++;
                                this.bitArray.setBit(position, 1);
                            }
                        }
                        if(!wasSet)
                            this.bitArray.setBit(position, 0);
                        wasSet = false;
                    }
                }
                else
                    for(var position = 0; position < SIZE; position++)
                        this.bitArray.setBit(position, 0);
            }

            Set.prototype.showElements = function()
            {
                for(let position = 0; position < SIZE; position++)
                        if(this.bitArray.isSet(position))
                            console.log(position);
            }

            Set.union = function(setA, setB)
            {
                var result = new Set();
                for(var position = 0; position < SIZE; position++)
                {
                    if(setA.bitArray.isSet(position) || setB.bitArray.isSet(position))
                        result.bitArray.setBit(position, 1);
                }
                return result;
            }

            Set.intersection = function(setA, setB)
            {
                var result = new Set();
                for(var position = 0; position < SIZE; position++)
                {
                    if(setA.bitArray.isSet(position) && setB.bitArray.isSet(position))
                        result.bitArray.setBit(position, 1);
                }
                return result;
            }

            Set.difference = function(setA, setB)
            {
                var result = new Set();
                for(var position = 0; position < SIZE; position++)
                {
                    if(setA.bitArray.isSet(position) && !setB.bitArray.isSet(position))
                        result.bitArray.setBit(position, 1);
                }
                return result;
            }

            var A = new Set([1, 2, 3, 6, 7, 8]);
            var B = new Set([2, 3, 5, 9]);

            var resultAdd = Set.union(A, B);
            resultAdd.showElements();

            console.log(" ");

            var resultIntersect = Set.intersection(A, B);
            resultIntersect.showElements();

            console.log(" ");

            var resultDifference = Set.difference(A, B);
            resultDifference.showElements();
        </script>
    </body>
</html>